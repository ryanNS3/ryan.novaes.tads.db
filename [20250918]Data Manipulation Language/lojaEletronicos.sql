CREATE TABLE CLIENTE(
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(200) NOT NULL,
    EMAIL VARCHAR2(320) NOT NULL UNIQUE
    

);

CREATE TABLE PRODUTO(
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOME VARCHAR(200) NOT NULL,
    PRECO NUMBER(10,2) NOT NULL CHECK(PRECO >= 0),
    TIPO VARCHAR(50) NOT NULL

);

CREATE TABLE PEDIDO(
    ID         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    CLIENTE_ID NUMBER NOT NULL,
    PRODUTO_ID NUMBER NOT NULL,
    STATUS     VARCHAR2(20) NOT NULL CHECK (status IN ('ABERTO','FINALIZADO','CANCELADO'))

);




-- INSERINDO CLIENTES
INSERT INTO
CLIENTE(NOME, EMAIL) VALUES ('RYAN', 'RYAN@GMAIL.COM');


-- INSERINDO PRODUTOS
INSERT INTO PRODUTO(NOME,PRECO,TIPO) VALUES ('LG VELVET', 1000.00, 'celular');

UPDATE PRODUTO SET PRECO = 10 WHERE  PRODUTO.ID LIKE 21;

-- INSERINDO PEDIDOS

-- INSERINDO PRODUTOS
INSERT INTO PEDIDO(CLIENTE_ID,PRODUTO_ID,STATUS) VALUES (1, 2, 'ABERTO');
INSERT INTO PEDIDO(CLIENTE_ID,PRODUTO_ID,STATUS) VALUES (1, 3, 'CANCELADO');


-- CRIANDO UMA TABELA TEMPORARIA PARA ADICIONAR NOVOS PEDIDOS
CREATE TABLE NOVOS_PEDIDOS(
    ID         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    CLIENTE_ID NUMBER NOT NULL,
    PRODUTO_ID NUMBER NOT NULL,
    STATUS     VARCHAR2(20) NOT NULL CHECK (status IN ('ABERTO','FINALIZADO','CANCELADO'))
);

INSERT INTO NOVOS_PEDIDOS(CLIENTE_ID,PRODUTO_ID,STATUS) VALUES (1, 2, 'ABERTO');
INSERT INTO NOVOS_PEDIDOS(CLIENTE_ID,PRODUTO_ID,STATUS) VALUES (1, 3, 'FINALIZADO');

SELECT CLIENTE_ID,PRODUTO_ID,STATUS FROM PEDIDO;

SELECT CLIENTE_ID,PRODUTO_ID,STATUS FROM NOVOS_PEDIDOS;

-- Deletando os pedidos cancelados
DELETE FROM PEDIDO
WHERE PEDIDO.STATUS = 'CANCELADO';
SELECT CLIENTE_ID,PRODUTO_ID,STATUS FROM PEDIDO;


MERGE INTO PEDIDO 
USING NOVOS_PEDIDOS 
ON (PEDIDO.ID = NOVOS_PEDIDOS.ID)
WHEN MATCHED THEN
    UPDATE SET PEDIDO.STATUS = NOVOS_PEDIDOS.STATUS,
               PEDIDO.CLIENTE_ID = NOVOS_PEDIDOS.CLIENTE_ID,
               PEDIDO.PRODUTO_ID = NOVOS_PEDIDOS.PRODUTO_ID

WHEN NOT MATCHED THEN
    INSERT (CLIENTE_ID,PRODUTO_ID,STATUS)
    VALUES(NOVOS_PEDIDOS.CLIENTE_ID, NOVOS_PEDIDOS.PRODUTO_ID, NOVOS_PEDIDOS.STATUS );
    



SELECT * FROM PEDIDO;